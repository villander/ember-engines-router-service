{"version":3,"file":"engine-router-service.js","sources":["../../src/services/engine-router-service.js"],"sourcesContent":["/* eslint-disable ember/no-computed-properties-in-native-classes */\nimport Service from '@ember/service';\nimport { assert } from '@ember/debug';\nimport { action, computed } from '@ember/object';\nimport { reads } from '@ember/object/computed';\nimport { getOwner } from '@ember/application';\nimport Evented from '@ember/object/evented';\nimport { macroCondition, dependencySatisfies } from '@embroider/macros';\nimport { namespaceEngineRouteName } from '../utils/namespace-engine-route-name.js';\nimport { getRootOwner } from '../utils/root-owner.js';\nimport { resemblesURL } from '../utils/resembles-url.js';\n\nconst warningMessage =\n  'Refresh method is not available in ember-source below v4.1';\n\nexport default class EngineRouterService extends Service.extend(Evented) {\n  constructor(...args) {\n    super(...args);\n\n    this._externalRoutes = getOwner(this)._externalRoutes;\n    // eslint-disable-next-line ember/no-assignment-of-untracked-properties-used-in-tracking-contexts\n    this._mountPoint = getOwner(this).mountPoint;\n    this.rootApplication = getRootOwner(this);\n\n    this.externalRouter.on('routeWillChange', this.onRouteWillChange);\n    this.externalRouter.on('routeDidChange', this.onRouteDidChange);\n  }\n\n  willDestroy() {\n    this.externalRouter.off('routeWillChange', this.onRouteWillChange);\n    this.externalRouter.off('routeDidChange', this.onRouteDidChange);\n\n    super.willDestroy();\n  }\n\n  @action\n  onRouteWillChange(...args) {\n    this.trigger('routeWillChange', ...args);\n  }\n\n  @action\n  onRouteDidChange(...args) {\n    this.trigger('routeDidChange', ...args);\n  }\n\n  @reads('externalRouter.rootURL') rootURL;\n\n  @reads('externalRouter.currentURL') currentURL;\n\n  @computed('_mountPoint.length', 'externalRouter.currentRouteName')\n  get currentRouteName() {\n    if (this.externalRouter.currentRouteName === this._mountPoint) {\n      return 'application';\n    }\n    return this.externalRouter.currentRouteName.slice(\n      this._mountPoint.length + 1,\n    );\n  }\n\n  get externalRouter() {\n    return this.rootApplication.lookup('service:router');\n  }\n\n  getExternalRouteName(externalRouteName) {\n    assert(\n      `External route '${externalRouteName}' is unknown.`,\n      externalRouteName in this._externalRoutes,\n    );\n    return this._externalRoutes[externalRouteName];\n  }\n\n  refresh(routeName = this.currentRouteName, ...args) {\n    if (macroCondition(dependencySatisfies('ember-source', '>= 4.1.0'))) {\n      if (resemblesURL(routeName)) {\n        return this.externalRouter.refresh(routeName);\n      }\n\n      return this.externalRouter.refresh(\n        namespaceEngineRouteName(this._mountPoint, routeName),\n        ...args,\n      );\n    } else {\n      assert(warningMessage);\n    }\n  }\n\n  refreshExternal(routeName, ...args) {\n    if (macroCondition(dependencySatisfies('ember-source', '>= 4.1.0'))) {\n      return this.externalRouter.refresh(\n        this.getExternalRouteName(routeName),\n        ...args,\n      );\n    } else {\n      assert(warningMessage);\n    }\n  }\n\n  transitionTo(routeName, ...args) {\n    if (resemblesURL(routeName)) {\n      return this.externalRouter.transitionTo(routeName);\n    }\n\n    return this.externalRouter.transitionTo(\n      namespaceEngineRouteName(this._mountPoint, routeName),\n      ...args,\n    );\n  }\n\n  transitionToExternal(routeName, ...args) {\n    return this.externalRouter.transitionTo(\n      this.getExternalRouteName(routeName),\n      ...args,\n    );\n  }\n\n  replaceWith(routeName, ...args) {\n    if (resemblesURL(routeName)) {\n      return this.externalRouter.replaceWith(routeName);\n    }\n\n    return this.externalRouter.replaceWith(\n      namespaceEngineRouteName(this._mountPoint, routeName),\n      ...args,\n    );\n  }\n\n  replaceWithExternal(routeName, ...args) {\n    return this.externalRouter.replaceWith(\n      this.getExternalRouteName(routeName),\n      ...args,\n    );\n  }\n\n  urlFor(routeName, ...args) {\n    return this.externalRouter.urlFor(\n      namespaceEngineRouteName(this._mountPoint, routeName),\n      ...args,\n    );\n  }\n\n  urlForExternal(routeName, ...args) {\n    return this.externalRouter.urlFor(\n      this.getExternalRouteName(routeName),\n      ...args,\n    );\n  }\n\n  isActive(routeName, ...args) {\n    return this.externalRouter.isActive(\n      namespaceEngineRouteName(this._mountPoint, routeName),\n      ...args,\n    );\n  }\n\n  isActiveExternal(routeName, ...args) {\n    return this.externalRouter.isActive(\n      this.getExternalRouteName(routeName),\n      ...args,\n    );\n  }\n}\n"],"names":["warningMessage","EngineRouterService","Service","extend","Evented","constructor","args","_externalRoutes","getOwner","_mountPoint","mountPoint","rootApplication","getRootOwner","externalRouter","on","onRouteWillChange","onRouteDidChange","willDestroy","off","trigger","n","prototype","action","g","reads","i","void 0","currentRouteName","slice","length","computed","lookup","getExternalRouteName","externalRouteName","assert","refresh","routeName","macroCondition","dependencySatisfies","resemblesURL","namespaceEngineRouteName","refreshExternal","transitionTo","transitionToExternal","replaceWith","replaceWithExternal","urlFor","urlForExternal","isActive","isActiveExternal"],"mappings":";;;;;;;;;;;;AAAA;AAYA,MAAMA,cAAc,GAClB,4DAA4D,CAAA;AAE/C,MAAMC,mBAAmB,SAASC,OAAO,CAACC,MAAM,CAACC,OAAO,CAAC,CAAC;EACvEC,WAAWA,CAAC,GAAGC,IAAI,EAAE;IACnB,KAAK,CAAC,GAAGA,IAAI,CAAC,CAAA;IAEd,IAAI,CAACC,eAAe,GAAGC,QAAQ,CAAC,IAAI,CAAC,CAACD,eAAe,CAAA;AACrD;IACA,IAAI,CAACE,WAAW,GAAGD,QAAQ,CAAC,IAAI,CAAC,CAACE,UAAU,CAAA;AAC5C,IAAA,IAAI,CAACC,eAAe,GAAGC,YAAY,CAAC,IAAI,CAAC,CAAA;IAEzC,IAAI,CAACC,cAAc,CAACC,EAAE,CAAC,iBAAiB,EAAE,IAAI,CAACC,iBAAiB,CAAC,CAAA;IACjE,IAAI,CAACF,cAAc,CAACC,EAAE,CAAC,gBAAgB,EAAE,IAAI,CAACE,gBAAgB,CAAC,CAAA;AACjE,GAAA;AAEAC,EAAAA,WAAWA,GAAG;IACZ,IAAI,CAACJ,cAAc,CAACK,GAAG,CAAC,iBAAiB,EAAE,IAAI,CAACH,iBAAiB,CAAC,CAAA;IAClE,IAAI,CAACF,cAAc,CAACK,GAAG,CAAC,gBAAgB,EAAE,IAAI,CAACF,gBAAgB,CAAC,CAAA;IAEhE,KAAK,CAACC,WAAW,EAAE,CAAA;AACrB,GAAA;EAGAF,iBAAiBA,CAAC,GAAGT,IAAI,EAAE;AACzB,IAAA,IAAI,CAACa,OAAO,CAAC,iBAAiB,EAAE,GAAGb,IAAI,CAAC,CAAA;AAC1C,GAAA;AAAC,EAAA;IAAAc,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,mBAAA,EAAA,CAHAC,MAAM,CAAA,CAAA,CAAA;AAAA,GAAA;EAMPN,gBAAgBA,CAAC,GAAGV,IAAI,EAAE;AACxB,IAAA,IAAI,CAACa,OAAO,CAAC,gBAAgB,EAAE,GAAGb,IAAI,CAAC,CAAA;AACzC,GAAA;AAAC,EAAA;IAAAc,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,kBAAA,EAAA,CAHAC,MAAM,CAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAAA;AAAAC,IAAAA,CAAA,MAAAF,SAAA,EAAA,SAAA,EAAA,CAKNG,KAAK,CAAC,wBAAwB,CAAC,CAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAAA,QAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,SAAA,CAAA,EAAAC,KAAA,CAAA,EAAA;AAAA,EAAA;AAAAH,IAAAA,CAAA,MAAAF,SAAA,EAAA,YAAA,EAAA,CAE/BG,KAAK,CAAC,2BAA2B,CAAC,CAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAAA,WAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,YAAA,CAAA,EAAAC,KAAA,CAAA,EAAA;EAEnC,IACIC,gBAAgBA,GAAG;IACrB,IAAI,IAAI,CAACd,cAAc,CAACc,gBAAgB,KAAK,IAAI,CAAClB,WAAW,EAAE;AAC7D,MAAA,OAAO,aAAa,CAAA;AACtB,KAAA;AACA,IAAA,OAAO,IAAI,CAACI,cAAc,CAACc,gBAAgB,CAACC,KAAK,CAC/C,IAAI,CAACnB,WAAW,CAACoB,MAAM,GAAG,CAC5B,CAAC,CAAA;AACH,GAAA;AAAC,EAAA;IAAAT,CAAA,CAAA,IAAA,CAAAC,SAAA,EARAS,kBAAAA,EAAAA,CAAAA,QAAQ,CAAC,oBAAoB,EAAE,iCAAiC,CAAC,CAAA,CAAA,CAAA;AAAA,GAAA;EAUlE,IAAIjB,cAAcA,GAAG;AACnB,IAAA,OAAO,IAAI,CAACF,eAAe,CAACoB,MAAM,CAAC,gBAAgB,CAAC,CAAA;AACtD,GAAA;EAEAC,oBAAoBA,CAACC,iBAAiB,EAAE;IACtCC,MAAM,CACJ,CAAmBD,gBAAAA,EAAAA,iBAAiB,CAAe,aAAA,CAAA,EACnDA,iBAAiB,IAAI,IAAI,CAAC1B,eAC5B,CAAC,CAAA;AACD,IAAA,OAAO,IAAI,CAACA,eAAe,CAAC0B,iBAAiB,CAAC,CAAA;AAChD,GAAA;EAEAE,OAAOA,CAACC,SAAS,GAAG,IAAI,CAACT,gBAAgB,EAAE,GAAGrB,IAAI,EAAE;IAClD,IAAI+B,cAAc,CAACC,mBAAmB,CAAC,cAAc,EAAE,UAAU,CAAC,CAAC,EAAE;AACnE,MAAA,IAAIC,YAAY,CAACH,SAAS,CAAC,EAAE;AAC3B,QAAA,OAAO,IAAI,CAACvB,cAAc,CAACsB,OAAO,CAACC,SAAS,CAAC,CAAA;AAC/C,OAAA;AAEA,MAAA,OAAO,IAAI,CAACvB,cAAc,CAACsB,OAAO,CAChCK,wBAAwB,CAAC,IAAI,CAAC/B,WAAW,EAAE2B,SAAS,CAAC,EACrD,GAAG9B,IACL,CAAC,CAAA;AACH,KAAC,MAAM;MACL4B,MAAM,CAAClC,cAAc,CAAC,CAAA;AACxB,KAAA;AACF,GAAA;AAEAyC,EAAAA,eAAeA,CAACL,SAAS,EAAE,GAAG9B,IAAI,EAAE;IAClC,IAAI+B,cAAc,CAACC,mBAAmB,CAAC,cAAc,EAAE,UAAU,CAAC,CAAC,EAAE;AACnE,MAAA,OAAO,IAAI,CAACzB,cAAc,CAACsB,OAAO,CAChC,IAAI,CAACH,oBAAoB,CAACI,SAAS,CAAC,EACpC,GAAG9B,IACL,CAAC,CAAA;AACH,KAAC,MAAM;MACL4B,MAAM,CAAClC,cAAc,CAAC,CAAA;AACxB,KAAA;AACF,GAAA;AAEA0C,EAAAA,YAAYA,CAACN,SAAS,EAAE,GAAG9B,IAAI,EAAE;AAC/B,IAAA,IAAIiC,YAAY,CAACH,SAAS,CAAC,EAAE;AAC3B,MAAA,OAAO,IAAI,CAACvB,cAAc,CAAC6B,YAAY,CAACN,SAAS,CAAC,CAAA;AACpD,KAAA;AAEA,IAAA,OAAO,IAAI,CAACvB,cAAc,CAAC6B,YAAY,CACrCF,wBAAwB,CAAC,IAAI,CAAC/B,WAAW,EAAE2B,SAAS,CAAC,EACrD,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AAEAqC,EAAAA,oBAAoBA,CAACP,SAAS,EAAE,GAAG9B,IAAI,EAAE;AACvC,IAAA,OAAO,IAAI,CAACO,cAAc,CAAC6B,YAAY,CACrC,IAAI,CAACV,oBAAoB,CAACI,SAAS,CAAC,EACpC,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AAEAsC,EAAAA,WAAWA,CAACR,SAAS,EAAE,GAAG9B,IAAI,EAAE;AAC9B,IAAA,IAAIiC,YAAY,CAACH,SAAS,CAAC,EAAE;AAC3B,MAAA,OAAO,IAAI,CAACvB,cAAc,CAAC+B,WAAW,CAACR,SAAS,CAAC,CAAA;AACnD,KAAA;AAEA,IAAA,OAAO,IAAI,CAACvB,cAAc,CAAC+B,WAAW,CACpCJ,wBAAwB,CAAC,IAAI,CAAC/B,WAAW,EAAE2B,SAAS,CAAC,EACrD,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AAEAuC,EAAAA,mBAAmBA,CAACT,SAAS,EAAE,GAAG9B,IAAI,EAAE;AACtC,IAAA,OAAO,IAAI,CAACO,cAAc,CAAC+B,WAAW,CACpC,IAAI,CAACZ,oBAAoB,CAACI,SAAS,CAAC,EACpC,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AAEAwC,EAAAA,MAAMA,CAACV,SAAS,EAAE,GAAG9B,IAAI,EAAE;AACzB,IAAA,OAAO,IAAI,CAACO,cAAc,CAACiC,MAAM,CAC/BN,wBAAwB,CAAC,IAAI,CAAC/B,WAAW,EAAE2B,SAAS,CAAC,EACrD,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AAEAyC,EAAAA,cAAcA,CAACX,SAAS,EAAE,GAAG9B,IAAI,EAAE;AACjC,IAAA,OAAO,IAAI,CAACO,cAAc,CAACiC,MAAM,CAC/B,IAAI,CAACd,oBAAoB,CAACI,SAAS,CAAC,EACpC,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AAEA0C,EAAAA,QAAQA,CAACZ,SAAS,EAAE,GAAG9B,IAAI,EAAE;AAC3B,IAAA,OAAO,IAAI,CAACO,cAAc,CAACmC,QAAQ,CACjCR,wBAAwB,CAAC,IAAI,CAAC/B,WAAW,EAAE2B,SAAS,CAAC,EACrD,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AAEA2C,EAAAA,gBAAgBA,CAACb,SAAS,EAAE,GAAG9B,IAAI,EAAE;AACnC,IAAA,OAAO,IAAI,CAACO,cAAc,CAACmC,QAAQ,CACjC,IAAI,CAAChB,oBAAoB,CAACI,SAAS,CAAC,EACpC,GAAG9B,IACL,CAAC,CAAA;AACH,GAAA;AACF;;;;"}